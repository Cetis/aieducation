import{r as t,h as n,H as i,g as r}from"./p-68751d42.js";import"./p-fdff0b98.js";import{f as e,g as o,l,a as s,s as a}from"./p-794a040d.js";import{l as c}from"./p-373b29c4.js";import{r as u}from"./p-1e7506b0.js";function h(t){return t}function f(t){return"translate("+t+",0)"}function d(t){return"translate(0,"+t+")"}function m(t){return n=>+t(n)}function p(t,n){return n=Math.max(0,t.bandwidth()-2*n)/2,t.round()&&(n=Math.round(n)),i=>+t(i)+n}function g(){return!this.__axis}function b(t,n){var i=[],r=null,e=null,o=6,l=6,s=3,a="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||4===t?-1:1,u=4===t||2===t?"x":"y",b=1===t||3===t?f:d;function v(f){var d=null==r?n.ticks?n.ticks.apply(n,i):n.domain():r,v=null==e?n.tickFormat?n.tickFormat.apply(n,i):h:e,y=Math.max(o,0)+s,x=n.range(),w=+x[0]+a,k=+x[x.length-1]+a,M=(n.bandwidth?p:m)(n.copy(),a),D=f.selection?f.selection():f,j=D.selectAll(".domain").data([null]),H=D.selectAll(".tick").data(d,n).order(),A=H.exit(),V=H.enter().append("g").attr("class","tick"),C=H.select("line"),F=H.select("text");j=j.merge(j.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),H=H.merge(V),C=C.merge(V.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),F=F.merge(V.append("text").attr("fill","currentColor").attr(u,c*y).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),f!==D&&(j=j.transition(f),H=H.transition(f),C=C.transition(f),F=F.transition(f),A=A.transition(f).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=M(t))?b(t+a):this.getAttribute("transform")})),V.attr("opacity",1e-6).attr("transform",(function(t){var n=this.parentNode.__axis;return b((n&&isFinite(n=n(t))?n:M(t))+a)}))),A.remove(),j.attr("d",4===t||2===t?l?"M"+c*l+","+w+"H"+a+"V"+k+"H"+c*l:"M"+a+","+w+"V"+k:l?"M"+w+","+c*l+"V"+a+"H"+k+"V"+c*l:"M"+w+","+a+"H"+k),H.attr("opacity",1).attr("transform",(function(t){return b(M(t)+a)})),C.attr(u+"2",c*o),F.attr(u,c*y).text(v),D.filter(g).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),D.each((function(){this.__axis=M}))}return v.scale=function(t){return arguments.length?(n=t,v):n},v.ticks=function(){return i=Array.from(arguments),v},v.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),v):i.slice()},v.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),v):r&&r.slice()},v.tickFormat=function(t){return arguments.length?(e=t,v):e},v.tickSize=function(t){return arguments.length?(o=l=+t,v):o},v.tickSizeInner=function(t){return arguments.length?(o=+t,v):o},v.tickSizeOuter=function(t){return arguments.length?(l=+t,v):l},v.tickPadding=function(t){return arguments.length?(s=+t,v):s},v.offset=function(t){return arguments.length?(a=+t,v):a},v}const v=class{constructor(n){t(this,n),this.listenToMeasureChanges=!0,this.dataSrc=null,this.color="red",this.size="normal",this.radius=3,this.hasRenderedChart=!1,this.measureName=o("measure"),this.keys="@pillars",this.pillar=null,this.theme="light",this.useFlags=!1}measureSelected(t){this.listenToMeasureChanges&&t.detail&&t.detail.filter&&"measure"==t.detail.filter&&(this.measureName=t.detail.value)}async componentWillLoad(){this.data=await l(this.dataSrc)}componentWillRender(){}componentWillUpdate(){}componentDidUpdate(){this.measureName&&!this.hasRenderedChart&&this.draw(),this.update()}componentDidLoad(){this.chartElement=this.element.shadowRoot.getElementById("oi-beeswarm"),this.measureName&&this.draw()}formatData(){let t=[],n={};n[this.measureName]="*any";let i=this.data.get(n);for(let n=0;n<i.length;n++){let r=i[n],e={title:r.get("country"),subtitle:r.get("iso"),measures:r.get(this.measureName)};t.push(e)}return t}update(){this.chart=this.chart.color(s(this.measureName));let t=this.formatData();this.svg.selectAll(".circle-container").data(t,(function(t){return t.title})).call(this.chart)}draw(){var t=b(3,c().domain([100,0]).range([0,600]));this.svg=a(this.chartElement).append("svg").attr("id","svg-container").attr("class","svg-content").attr("viewBox","0 0 600 400").append("g").attr("class","svg-group");let n=this.formatData();this.chart=function(){var t=15,n="blue",i=!1;function r(r){var o=r.enter().merge(r).data().map((t=>Number(t.measures))),l=function(t){let n,i;for(const r of t)null!=r&&(void 0===n?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));return[n,i]}(o),s=c().domain(l).range([600-2*t,2*t]);o=o.map((t=>s(t)));var a=c().domain(l).range(["white",n]);const h=function(t,n){const i=new Float64Array(t.length),r=n**2;let e=null,o=null;function l(n,o){let l=e;for(;l;){const e=l.index;if(r-.001>(t[e]-n)**2+(i[e]-o)**2)return!0;l=l.next}return!1}for(const n of u(t.length).sort(((n,i)=>t[n]-t[i]))){for(;e&&t[e.index]<t[n]-r;)e=e.next;if(l(t[n],i[n]=0)){let o=e;i[n]=1/0;do{const e=o.index;let s=i[e]+Math.sqrt(r-(t[e]-t[n])**2),a=i[e]-Math.sqrt(r-(t[e]-t[n])**2);Math.abs(s)<Math.abs(i[n])&&!l(t[n],s)&&(i[n]=s),Math.abs(a)<Math.abs(i[n])&&!l(t[n],a)&&(i[n]=a),o=o.next}while(o)}const s={index:n,next:null};null===e?e=o=s:o=o.next=s}return i}(o,2*t+5);function f(t){return t.title+" "+e(t.measures)}r.join((r=>function(r){const e=r.append("g").attr("class","circle-container").attr("id",(function(t){return t.title}));e.append("title").text(f),e.append("circle").attr("cx",(t=>s(t.measures))).attr("cy",((t,n)=>200+h[n])).attr("r",t).style("stroke",n).style("fill",(t=>a(t.measures))),i?(e.append("clipPath").attr("id",(t=>"flag-"+t.subtitle)).append("circle").attr("cx",(t=>s(t.measures))).attr("cy",((t,n)=>200+h[n])).attr("r",t),e.append("image").attr("href",(t=>"https://flagcdn.com/w80/"+t.subtitle+".png")).attr("clip-path",(t=>"url(#flag-"+t.subtitle+")")).attr("x",(t=>s(t.measures)-40)).attr("y",((t,n)=>200+h[n]-20)).attr("width","80").attr("height","40")):e.append("text").attr("class",(t=>t.measures>60?"label label-high":"label label-low")).attr("x",(t=>s(t.measures))).attr("y",((t,n)=>200+h[n])).attr("dy",".35em").attr("text-anchor","middle").text((t=>t.subtitle.toUpperCase()))}(r)),(t=>function(t){t.transition().duration(1e3).select("circle").attr("cx",(t=>s(t.measures))).attr("cy",((t,n)=>200+h[n])).style("stroke",n).style("fill",(t=>a(t.measures))),t.select("title").text(f),t.transition().duration(1e3).select("text").attr("class",(t=>t.measures>60?"label label-high":"label label-low")).attr("x",(t=>s(t.measures))).attr("y",((t,n)=>200+h[n])).attr("dy",".35em").text((t=>t.subtitle.toUpperCase())),i&&(t.transition().duration(1e3).select("image").attr("x",(t=>s(t.measures)-40)).attr("y",((t,n)=>200+h[n]-20)),t.transition().duration(1e3).select("clipPath").select("circle").attr("cx",(t=>s(t.measures))).attr("cy",((t,n)=>200+h[n])))}(t)))}return r.color=function(t){return arguments.length?(n=t,r):n},r.radius=function(n){return arguments.length?(t=n,r):t},r.useFlags=function(t){return arguments.length?(i=t,r):i},r}().color(s(this.measureName)).radius(this.radius).useFlags(this.useFlags),this.svg.selectAll("g").data(n,(function(t){return t.title})).call(this.chart),a(this.chartElement).select("svg").append("g").attr("class","svg-group-index").call(t),this.hasRenderedChart=!0}filter(){}render(){return n(i,null,n("div",{id:"oi-beeswarm",class:"svg-container "+this.theme,tabindex:"0"}))}get element(){return r(this)}};v.style=":host{display:block;align-items:center;width:100%;background-color:var(--light-color)}.dark{background-color:var(--primary-color);color:var(--light-color)}.label{font-size:0.5rem}.label-high{fill:var(--light-color)}.label-low{fill:var(--text-color)}.svg-container{display:inline-block;position:relative;width:100%;padding-bottom:50%;vertical-align:top;overflow:hidden}.svg-container.small{padding-bottom:30%;}.svg-content{display:inline-block;position:absolute;top:0;left:0;width:100%;height:100%}.svg-container.small{padding-bottom:5%;}path:hover{stroke-width:1px;stroke:white}circle{fill:none;stroke:#DDDDDD}#chart{margin:10px}:focus{outline:none;text-decoration:underline}";export{v as oi_beeswarm}