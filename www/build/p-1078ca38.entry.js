import{r as t,h as i,g as e}from"./p-68751d42.js";import"./p-d9655876.js";import{s as n,f as r,g as l,l as s,w as a,a as o}from"./p-56e73c83.js";import{l as h}from"./p-373b29c4.js";function c(t){return t.measures}function u(t,i=0){var e=t(0);return function(n){return Math.abs(t(n)-e+i)}}const d=class{constructor(i){t(this,i),this.dataSrc=null,this.keys="Vision,Governance and Ethics,Digital Capacity,Adaptability,Size,Innovation Capacity,Human Capital,Infrastructure,Data Availability,Data Representativeness",this.name="country",this.country=l(this.name),this.compareWith="benchmark",this.benchmark=l(this.compareWith),this.size="normal",this.pillar=null,this.useTheme=!1,this.theme="light",this.hasRenderedChart=!1}countrySelected(t){t.detail&&t.detail.filter&&(t.detail.filter===this.name?this.country=t.detail.value:t.detail.filter===this.compareWith?this.benchmark=t.detail.value:"pillar"===t.detail.filter&&this.pillar&&(this.hasRenderedChart=!1,this.pillar=t.detail.value))}async componentWillLoad(){this.country=l(this.name)||this.country,this.data=await s(this.dataSrc)}componentWillRender(){this.country_data=this.prepareData(this.country),this.benchmark_data=this.prepareData(this.benchmark)}componentWillUpdate(){}componentDidUpdate(){this.country_data=this.prepareData(this.country),this.benchmark_data=this.prepareData(this.benchmark),!this.country&&!this.benchmark||this.hasRenderedChart||this.draw(),this.update()}componentDidLoad(){this.chartElement=this.element.shadowRoot.getElementById("oi-bullet-chart"),(this.country||this.benchmark)&&this.draw()}prepareData(t){return this.data.get({country:t})[0]}formatData(t,i){let e=[],n=this.data.keyList(this.keys,this.pillar);for(let r=0;r<n.length;r++){let l=n[r],s=[];t&&(s=[t.get(l),0]),i&&t&&(s=[t.get(l),i.get(l)]);let a=[];this.country&&(a=[this.country]),this.country&&this.benchmark&&(a=[this.country,this.benchmark]),e.push({title:l,subtitle:"",measures:s,scale:100,names:a})}return e}update(){let t=this.formatData(this.country_data,this.benchmark_data),i=n(this.chartElement).selectAll("svg").selectAll("g.bullet-transform"),e=this.map_update;i.datum((function(i){return e(i,t)})).call(this.chart.duration(1e3))}map_update(t,i){let e=t.title;for(let n=0;n<i.length;n++)if(i[n].title===e)return t.measures=i[n].measures,t.names=i[n].names,t}highlight(t,i,e){let r=n(e).selectAll("svg").selectAll("rect.measure.s0"),l=n(t).select("rect.measure.s0");if(i)"0.8"===l.attr("opacity")||"0.4"===l.attr("opacity")?(r.attr("opacity","0.4"),l.attr("opacity","1.0")):r.attr("opacity","0.8");else{let t="#6D88A3",i="mediumvioletred";l.attr("fill")===t?(r.attr("fill",t),l.attr("fill",i)):r.attr("fill",t)}}draw(){this.chart=null,n(this.chartElement).selectAll("div")&&n(this.chartElement).selectAll("div").remove(),this.element.shadowRoot.getElementById("placeholder")&&this.element.shadowRoot.getElementById("placeholder").remove();let t=this.useTheme,i=this.data,e=15;"small"===this.size&&(e=10),this.hasRenderedChart=!0;this.chart=function(){var t="left",i=!1,e=0,l=c,s=380,a="normal",o=12.5,d=null,f=25;let p=[];function m(t){t.each((function(t){var l=t.measures,a=t.names,c=t.title,m=n(this),b=0;b=h().domain([0,100]).range(i?[s,0]:[0,s]);var g=this.__chart__||h().domain([0,100]).range(b.range());this.__chart__=b;var v=u(g),x=u(b),y=u(b,5),w=m.selectAll("rect.measure").data(l);w.enter().append("rect").attr("tabindex",(function(t,i){return 0===i||1===i&&2===a.length?0:-1})).attr("class",(function(t,i){return"measure s"+i})).attr("fill",(function(t,i){return d(c,i)})).attr("opacity","0.8").attr("width",v).attr("height",f/a.length).attr("x",i?g:0).attr("y",(function(t,i){return o*i})).transition().duration(e).attr("width",x).attr("x",i?b:0),w.enter().append("title").text((function(t,i){return a[i]+": "+c+": "+r(t)})).attr("aria-label",(function(t,i){return a[i]+": "+c+": "+r(t)})),w.transition().duration(e).attr("tabindex",(function(t,i){return 0===i||1===i&&2===a.length?0:-1})).attr("width",x).attr("height",f/a.length).attr("x",i?b:0).attr("y",(function(t,i){return o*i})).select("title").text((function(t,i){return a[i]+": "+c+": "+r(t)})).attr("aria-label",(function(t,i){return a[i]+": "+c+": "+r(t)}));var k=m.selectAll("text.chart-label").data(l);k.enter().append("text").attr("class","chart-label").attr("x",v).attr("y",(function(t,i){return 2===a.length?p[i]:p[2]})).text((function(t,i){return a[i]?r(t):""})).attr("dy","0.2em").transition().duration(e).attr("x",y),k.transition().duration(e).attr("x",y).attr("y",(function(t,i){return 2===a.length?p[i]:p[2]})).text((function(t,i){return a[i]?r(t):""}))}))}return p[0]=7.5,p[1]=20,p[2]=12.5,m.orient=function(e){return arguments.length?(i="right"==(t=e)||"bottom"==t,m):t},m.measures=function(t){return arguments.length?(l=t,m):l},m.height=function(t){return arguments.length?(f=t,m):f},m.width=function(t){return arguments.length?(s=t,m):s},m.colours=function(t){return arguments.length?(d=t,m):d},m.size=function(t){return arguments.length?(f="normal"===t?25:14,o="normal"===t?12.5:7,p[0]="normal"===(a=t)?7.5:5,p[1]="normal"===a?20:12,p[2]="normal"===a?12.5:8,m):a},m.duration=function(t){return arguments.length?(e=t,m):e},m}().size(this.size).colours((function(e,n){return t?0===n?o(i.getPillar(e)):"#ddd":0===n?"#6D88A3":"#ddd"}));let l=this.highlight,s=this.chartElement,d=this.formatData(this.country_data,this.benchmark_data),f=n(this.chartElement).selectAll("svg").data(d).enter().append("div").classed("svg-container "+this.size,!0).append("svg").classed("svg-content bullet "+this.size,!0).on("click",(function(){l(this,t,s)})).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 620 "+(e+5)).append("g").attr("class","bullet-transform").attr("transform","translate(200,0)"),p=f.append("g").attr("tabindex",-1).attr("focusable","false").style("text-anchor","end").attr("transform","translate(-6,"+e+")");p.append("text").attr("class","title").text((function(t){return t.title})).each(a(45,1)),p.append("text").attr("class","subtitle").attr("dy","1em").text((function(t){return t.subtitle})),n(this.chartElement).append("div").attr("class","placeholder"),f.call(this.chart)}render(){return i("div",{class:this.theme},i("div",{id:"oi-bullet-chart",tabindex:"0"}),i("div",{id:"placeholder"},i("slot",null)))}get element(){return e(this)}};d.style=":host{display:block;width:100%;align-items:center;background-color:var(--background-color);color:var(--text-color)}.dark{color:var(--light-color);background-color:var(--primary-color)}.dark .bullet .chart-label,.dark .bullet .title,.dark .bullet .subtitle{fill:var(--light-color)}.svg-container{display:inline-block;position:relative;width:100%;padding-bottom:7%;vertical-align:top;overflow:hidden}.svg-container.small{padding-bottom:4%;}.svg-content{display:inline-block;position:absolute;top:0;left:0;width:100%;height:100%}.bullet .chart-label{fill:var(--text-color);font-size:14px}.bullet .chart-label{font-weight:bold}.bullet .title{font-weight:normal;font-size:14px}.bullet .subtitle{font-size:10px}.bullet.small .title{font-size:10px}.bullet.small .chart-label{font-size:8px}#placeholder{background-color:var(--neutral-background-color);color:var(--text-color);width:100%;text-align:center;padding-top:20px;padding-bottom:20px;font-size:1rem;font-weight:lighter}";export{d as oi_bar_chart}